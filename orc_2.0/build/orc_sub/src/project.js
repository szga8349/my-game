__require=function e(t,n,r){function a(c,i){if(!n[c]){if(!t[c]){var s=c.split("/");if(s=s[s.length-1],!t[s]){var l="function"==typeof __require&&__require;if(!i&&l)return l(s,!0);if(o)return o(s,!0);throw new Error("Cannot find module '"+c+"'")}}var u=n[c]={exports:{}};t[c][0].call(u.exports,function(e){return a(t[c][1][e]||e)},u,u.exports,e,t,n,r)}return n[c].exports}for(var o="function"==typeof __require&&__require,c=0;c<r.length;c++)a(r[c]);return a}({launch:[function(e,t,n){"use strict";cc._RF.push(t,"d90383w0rZFq4qVfbFQ4oR9","launch"),cc.Class({extends:cc.Component,properties:{rank:{default:null,type:cc.Node},content:{default:null,type:cc.Node},listPrefab:{default:null,type:cc.Prefab}},createList:function(e,t,n){var r=cc.instantiate(this.listPrefab);t>3&&(r.getChildByName("bg-first").active=!0,r.getChildByName("name").color=cc.hexToColor("#FFFFFF"),r.getChildByName("score").color=cc.hexToColor("#FFFFFF")),n.avatarUrl==e.avatarUrl&&n.nickName==e.nickname&&(r.getChildByName("bg-first").active=!1,r.getChildByName("bg-self").active=!0,r.getChildByName("name").color=cc.hexToColor("#FFFFFF"),r.getChildByName("score").color=cc.hexToColor("#FFFFFF")),cc.find("index/text",r).getComponent(cc.Label).string=t+1,r.getChildByName("name").getComponent(cc.Label).string=e.nickname,r.getChildByName("score").getComponent(cc.Label).string=e.score+"m";var a=wx.createImage();a.onload=function(){var e=new cc.Texture2D;e.initWithElement(a),e.handleLoadedTexture();var t=new cc.SpriteFrame(e);r.getChildByName("head").getComponent(cc.Sprite).spriteFrame=t},a.src=e.avatarUrl;var o=r.height;r.y=-t*(o+30),this.content.height=(t+1)*(o+30),r.parent=this.content},formatList:function(e){var t=[];return(t=e.map(function(e){return{openid:e.openid,nickname:e.nickname,avatarUrl:e.avatarUrl,score:Number(JSON.parse(e.KVDataList.filter(function(e){return"all"===e.key})[0].value).wxgame.score),update_time:JSON.parse(e.KVDataList.filter(function(e){return"all"===e.key})[0].value).wxgame.update_time}})).sort(function(e){return function(t,n){var r=t[e],a=n[e];return isNaN(Number(r))||isNaN(Number(a))||(r=Number(r),a=Number(a)),r-a}}("score")).reverse(),t},getData:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];var e=this,t=[],n={};wx.getUserInfo({openIdList:["selfOpenId"],success:function(r){"getUserInfo:ok"==r.errMsg&&(n=r.data[0],wx.getFriendCloudStorage({keyList:["all"],success:function(r){if((t=e.formatList(r.data)).length>0){e.content.removeAllChildren();for(var a=0;a<t.length;a++)e.createList(t[a],a,n)}else e.content.getChildByName("loading").getComponent(cc.Label).string="\u6682\u65e0\u6570\u636e..."},fail:function(e){console.warn("\u83b7\u53d6\u5fae\u4fe1\u6570\u636e\u5931\u8d25",e)}}))},fail:function(t){e.content.getChildByName("loading").getComponent(cc.Label).string="\u83b7\u53d6\u7528\u6237\u4fe1\u606f\u5931\u8d25~"}})},postScore:function(e){function t(){var t={wxgame:{score:e,update_time:parseInt((new Date).getTime()/1e3)}},n={key:"all",value:JSON.stringify(t)};wx.setUserCloudStorage({KVDataList:[n],success:function(e){console.log("\u8bbe\u7f6e\u6570\u636e\u6210\u529f",e)}})}console.log("\u4e0a\u4f20\u5206\u6570: =====>",e),wx.getUserCloudStorage({keyList:["all"],success:function(n){if(console.log("\u83b7\u5f97\u5206\u6570\u6570\u636e\uff1a",n),"getUserCloudStorage:ok"==n.errMsg){if(0==n.KVDataList.length)return t();var r=JSON.parse(n.KVDataList[0].value);(!r.wxgame.score||r.wxgame.score<e)&&t()}}})},start:function(){var e=this;window.wx&&wx.onMessage(function(t){switch(t.action){case"updata":e.postScore(t.score);break;case"show":e.getData(),e.rank.active=!0;break;case"hide":e.rank.active=!1}})}}),cc._RF.pop()},{}]},{},["launch"]);